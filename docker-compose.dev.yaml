services:
  django:

    volumes:
      - .:/src/:rw
    env_file:
      - ./config/uvicorn.dev.env
      - ./config/django.dev.env
      - ./config/postgres.dev.env
    command: >
      uvicorn config.asgi:application 
          --reload 
          --host ${DJANGO_IP} 
          --port ${DJANGO_PORT} 
          --workers ${WORKERS_COUNT_UVICORN} 
          ${EXTRA_UVICORN_ARGS}
    ports:
      - ${DJANGO_PORT}:${DJANGO_PORT}

  postgres:
    env_file:
      - ./config/postgres.dev.env
    volumes:
      - db-data-test:/var/lib/postgresql/data:rw
  nginx:
    env_file:
      - ./config/uvicorn.dev.env
    ports:
      - 8000:80

volumes:
  db-data-test:
